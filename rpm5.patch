--- dnf/dnf/base.py~	2014-12-09 13:36:18.000000000 +0200
+++ dnf/dnf/base.py	2015-01-31 19:34:11.698771194 +0200
@@ -284,10 +284,9 @@
                         'nodocs': rpm.RPMTRANS_FLAG_NODOCS,
                         'test': rpm.RPMTRANS_FLAG_TEST,
                         'justdb': rpm.RPMTRANS_FLAG_JUSTDB,
-                        'nocontexts': rpm.RPMTRANS_FLAG_NOCONTEXTS,
-                        'nocrypto' : rpm.RPMTRANS_FLAG_NOFILEDIGEST}
-    _TS_VSFLAGS_TO_RPM = {'nocrypto' : rpm._RPMVSF_NOSIGNATURES |
-                          rpm._RPMVSF_NODIGESTS}
+                        'nocontexts': 0,
+                        'nocrypto' : 0}
+    _TS_VSFLAGS_TO_RPM = {'nocrypto' : rpm.RPMVSF_NODSAHEADER }
 
     @property
     def ts(self):
@@ -1254,7 +1253,7 @@
 
         installroot = self.conf.installroot
         myts = dnf.rpm.transaction.initReadOnlyTransaction(root=installroot)
-        myts.pushVSFlags(~(rpm._RPMVSF_NOSIGNATURES|rpm._RPMVSF_NODIGESTS))
+        myts.pushVSFlags(~rpm.RPMVSF_NODSAHEADER)
         idx = myts.dbMatch('name', 'gpg-pubkey')
         keys = len(idx)
         del idx
--- dnf/dnf/rpm/transaction.py~	2014-12-09 13:36:18.000000000 +0200
+++ dnf/dnf/rpm/transaction.py	2015-01-31 19:37:26.945547832 +0200
@@ -119,5 +119,5 @@
 
 def initReadOnlyTransaction(root='/'):
     read_ts =  TransactionWrapper(root=root)
-    read_ts.pushVSFlags((rpm._RPMVSF_NOSIGNATURES|rpm._RPMVSF_NODIGESTS))
+    read_ts.pushVSFlags(rpm.RPMVSF_NODSAHEADER)
     return read_ts
--- dnf/dnf/rpm/__init__.py~	2014-12-09 13:36:18.000000000 +0200
+++ dnf/dnf/rpm/__init__.py	2015-01-31 19:36:50.920349099 +0200
@@ -29,7 +29,7 @@
     """Calculate the release version for the system. :api"""
 
     ts = transaction.initReadOnlyTransaction(root=installroot)
-    ts.pushVSFlags(~(rpm._RPMVSF_NOSIGNATURES|rpm._RPMVSF_NODIGESTS))
+    ts.pushVSFlags(~rpm.RPMVSF_NODSAHEADER)
     for distroverpkg in dnf.const.DISTROVERPKG:
         try:
             idx = ts.dbMatch('provides', distroverpkg)
